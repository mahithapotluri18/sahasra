<!DOCTYPE html>
<html lang="en" data-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sahasra - Dashboard</title>
    <link rel="icon" type="image/png" href="{{ url_for('static', filename='images/sahasralogo.png') }}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
</head>
<body>
    <header class="dashboard-header">
        <div class="header-left">
            <h1 class="site-title">Sahasra</h1>
            <div class="nav-links">
                <a href="index.html" class="active">
                    <i class="fas fa-home"></i>
                    Home
                </a>
                <a href="payments.html">
                    <i class="fas fa-credit-card"></i>
                    Payments
                </a>
            </div>
            <div class="details-section">
                <button class="details-btn" id="detailsBtn">
                    <i class="fas fa-chart-bar"></i> Details
                </button>
                <div class="drill-down-sections" id="drillDownSections">
                    <button class="section-button" data-page="upload-products.html">
                        Upload Products
                        <i class="fas fa-upload"></i>
                    </button>
                    <button class="section-button" data-page="product-purchased.html">
                        Product Purchased
                        <i class="fas fa-shopping-cart"></i>
                    </button>
                    <button class="section-button" data-page="order-consumed.html">
                        Order Consumed
                        <i class="fas fa-box-open"></i>
                    </button>
                </div>
            </div>
        </div>
        <div class="tagline">Sahasra - Ignite the potential, Be the inspiration</div>
        <div class="header-right">
            <div class="user-profile">
                <div class="profile-trigger">
                    <img src="{{ url_for('static', filename='images/profile-placeholder.jpg') }}" alt="Profile" class="profile-img" id="profileImage">
                    <div class="profile-info">
                        <span class="username" id="profileName">User</span>
                        <span class="user-status">Online</span>
                    </div>
                    <i class="fas fa-chevron-down"></i>
                </div>
                <div class="profile-dropdown">
                    <a href="profile.html">
                        <i class="fas fa-user"></i>
                        My Profile
                    </a>
                    <a href="settings.html">
                        <i class="fas fa-cog"></i>
                        Settings
                    </a>
                    <a href="#" id="profileLogoutBtn">
                        <i class="fas fa-sign-out-alt"></i>
                        Logout
                    </a>
                </div>
            </div>
        </div>
    </header>

    <div class="search-section">
        <div class="search-container">
            <div class="search-input-group">
                <input type="text" class="search-input" placeholder="Search across categories...">
                <div class="search-buttons">
                    <button class="voice-btn" title="Voice Search">
                        <i class="fas fa-microphone"></i>
                    </button>
                    <button class="image-btn" title="Image Search">
                        <i class="fas fa-camera"></i>
                    </button>
                    <button class="search-btn">
                        <i class="fas fa-search"></i>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <div class="dashboard-content">
        <!-- First Row -->
        <div class="categories-grid">
            <div class="category-card" onclick="window.location.href='category-template.html?category=gardening'">
                <div class="category-icon">
                    <i class="fas fa-seedling"></i>
                </div>
                <h3>House Gardening</h3>
                <div class="location-input">
                    <input type="text" id="manualLocation" placeholder="Enter your location">
                    <button class="location-btn" onclick="useCurrentLocation()">
                        <i class="fas fa-map-marker-alt"></i> Use Current Location
                    </button>
                </div>
                <div id="locationStatus" class="location-status"></div>
            </div>
            <div class="category-card" onclick="window.location.href='category-template.html?category=healers'">
                <div class="category-icon">
                    <i class="fas fa-heart"></i>
                </div>
                <h3>The Healers</h3>
            </div>
            <div class="category-card" onclick="window.location.href='category-template.html?category=beauticians'">
                <div class="category-icon">
                    <i class="fas fa-spa"></i>
                </div>
                <h3>Beauticians</h3>
            </div>
        </div>

        <!-- Second Row -->
        <div class="categories-grid">
            <div class="category-card" onclick="window.location.href='category-template.html?category=hatching'">
                <div class="category-icon">
                    <i class="fas fa-egg"></i>
                </div>
                <h3>Hatching</h3>
            </div>
            <div class="category-card" onclick="window.location.href='category-template.html?category=designers'">
                <div class="category-icon">
                    <i class="fas fa-paint-brush"></i>
                </div>
                <h3>The Designers</h3>
            </div>
            <div class="category-card" onclick="window.location.href='category-template.html?category=homebytes'">
                <div class="category-icon">
                    <i class="fas fa-laptop-house"></i>
                </div>
                <h3>Home Bytes</h3>
            </div>
        </div>
    </div>

    <!-- Voice Search Modal -->
    <div id="voiceSearchModal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h2>Voice Search</h2>
            <div class="voice-status">
                <i class="fas fa-microphone"></i>
                <p>Listening...</p>
            </div>
        </div>
    </div>

    <!-- Image Search Modal -->
    <div id="imageSearchModal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h2>Image Search</h2>
            <input type="file" id="imageInput" accept="image/*">
            <div id="imagePreview"></div>
        </div>
    </div>

    <script src="{{ url_for('static', filename='js/script.js') }}"></script>
    <script src="{{ url_for('static', filename='js/cart.js') }}"></script>
    <script>
        // Load user profile
        function loadUserProfile() {
            const user = JSON.parse(localStorage.getItem('sahasra_user'));
            if (user) {
                document.getElementById('profileName').textContent = user.name || 'User';
                if (user.image) {
                    document.getElementById('profileImage').src = user.image;
                }
            }
        }

        // Voice search functionality
        const voiceSearchBtn = document.querySelector('.voice-btn');
        const voiceSearchModal = document.getElementById('voiceSearchModal');
        const voiceCloseBtn = voiceSearchModal.querySelector('.close');

        voiceSearchBtn.addEventListener('click', startVoiceSearch);
        voiceCloseBtn.addEventListener('click', () => voiceSearchModal.style.display = 'none');

        function startVoiceSearch() {
            voiceSearchModal.style.display = 'block';
            
            if ('webkitSpeechRecognition' in window) {
                const recognition = new webkitSpeechRecognition();
                recognition.continuous = false;
                recognition.interimResults = false;

                recognition.onstart = () => {
                    voiceSearchModal.querySelector('p').textContent = 'Listening...';
                };

                recognition.onresult = (event) => {
                    const transcript = event.results[0][0].transcript;
                    document.querySelector('.search-input').value = transcript;
                    voiceSearchModal.style.display = 'none';
                    performSearch(transcript);
                };

                recognition.onerror = (event) => {
                    voiceSearchModal.querySelector('p').textContent = 'Error occurred. Please try again.';
                };

                recognition.start();
            } else {
                voiceSearchModal.querySelector('p').textContent = 'Voice recognition not supported in this browser.';
            }
        }

        // Image search functionality
        const imageSearchBtn = document.querySelector('.image-btn');
        const imageSearchModal = document.getElementById('imageSearchModal');
        const imageCloseBtn = imageSearchModal.querySelector('.close');
        const imageInput = document.getElementById('imageInput');

        imageSearchBtn.addEventListener('click', () => imageSearchModal.style.display = 'block');
        imageCloseBtn.addEventListener('click', () => imageSearchModal.style.display = 'none');

        imageInput.addEventListener('change', (e) => {
            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = (e) => {
                    const img = document.createElement('img');
                    img.src = e.target.result;
                    const preview = document.getElementById('imagePreview');
                    preview.innerHTML = '';
                    preview.appendChild(img);
                    
                    // Here you would typically send the image to your backend for processing
                    // For now, we'll just simulate a search
                    setTimeout(() => {
                        imageSearchModal.style.display = 'none';
                        performSearch('Image search results');
                    }, 2000);
                };
                reader.readAsDataURL(file);
            }
        });

        // Search functionality
        const searchInput = document.querySelector('.search-input');
        const searchBtn = document.querySelector('.search-btn');

        searchInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                performSearch(searchInput.value);
            }
        });

        searchBtn.addEventListener('click', () => {
            performSearch(searchInput.value);
        });

        function performSearch(query) {
            // Filter categories based on search
            const categories = document.querySelectorAll('.category-card');
            categories.forEach(card => {
                const title = card.querySelector('h3').textContent.toLowerCase();
                if (title.includes(query.toLowerCase())) {
                    card.style.display = 'flex';
                } else {
                    card.style.display = 'none';
                }
            });
        }

        // Profile dropdown
        const profileTrigger = document.querySelector('.profile-trigger');
        const profileDropdown = document.querySelector('.profile-dropdown');

        profileTrigger.addEventListener('click', (e) => {
            e.stopPropagation();
            profileDropdown.classList.toggle('show');
        });

        document.addEventListener('click', (e) => {
            if (!profileTrigger.contains(e.target)) {
                profileDropdown.classList.remove('show');
            }
        });

        // Logout functionality
        document.getElementById('profileLogoutBtn').addEventListener('click', (e) => {
            e.preventDefault();
            localStorage.removeItem('sahasra_user');
            window.location.href = 'landing.html';
        });

        // Details button and drill down functionality
        const detailsBtn = document.getElementById('detailsBtn');
        const drillDownSections = document.getElementById('drillDownSections');
        const sectionButtons = document.querySelectorAll('.section-button');

        detailsBtn.addEventListener('click', () => {
            drillDownSections.classList.toggle('active');
        });

        sectionButtons.forEach(button => {
            button.addEventListener('click', () => {
                const targetPage = button.getAttribute('data-page');
                window.location.href = targetPage;
            });
        });

        // Location functionality
        function useCurrentLocation() {
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(
                    (position) => {
                        const { latitude, longitude } = position.coords;
                        checkLocationAvailability(latitude, longitude);
                    },
                    (error) => {
                        showLocationError("Unable to retrieve your location. Please enter it manually.");
                    }
                );
            } else {
                showLocationError("Geolocation is not supported by your browser. Please enter location manually.");
            }
        }

        function checkLocationAvailability(lat, lng) {
            // Simulated service area check
            const serviceCenter = { lat: 12.9716, lng: 77.5946 }; // Example coordinates for Sahasra
            const distance = calculateDistance(lat, lng, serviceCenter.lat, serviceCenter.lng);
            
            if (distance <= 50) {
                showLocationSuccess("Service is available in your area!");
            } else {
                showLocationError("Sorry, service is not available in your area yet.");
            }
        }

        function calculateDistance(lat1, lon1, lat2, lon2) {
            const R = 6371; // Earth's radius in kilometers
            const dLat = toRad(lat2 - lat1);
            const dLon = toRad(lon2 - lon1);
            const a = 
                Math.sin(dLat/2) * Math.sin(dLat/2) +
                Math.cos(toRad(lat1)) * Math.cos(toRad(lat2)) * 
                Math.sin(dLon/2) * Math.sin(dLon/2);
            const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
            return R * c;
        }

        function toRad(degrees) {
            return degrees * (Math.PI/180);
        }

        function showLocationError(message) {
            const status = document.getElementById('locationStatus');
            status.textContent = message;
            status.className = 'location-status error';
        }

        function showLocationSuccess(message) {
            const status = document.getElementById('locationStatus');
            status.textContent = message;
            status.className = 'location-status success';
        }

        // Initialize Google Places Autocomplete for manual location input
        function initializeLocationAutocomplete() {
            const input = document.getElementById('manualLocation');
            const autocomplete = new google.maps.places.Autocomplete(input);
            
            autocomplete.addListener('place_changed', () => {
                const place = autocomplete.getPlace();
                if (place.geometry) {
                    checkLocationAvailability(
                        place.geometry.location.lat(),
                        place.geometry.location.lng()
                    );
                }
            });
        }

        // Initialize
        loadUserProfile();
        initializeLocationAutocomplete();
    </script>
    <!-- Add Google Places API script -->
    <script src="https://maps.googleapis.com/maps/api/js?key=YOUR_GOOGLE_MAPS_API_KEY&libraries=places&callback=initializeLocationAutocomplete" async defer></script>
</body>
</html>